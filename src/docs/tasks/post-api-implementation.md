# 投稿API実装

## 概要
ブログ投稿作成APIを実装しました。このAPIはログイン済み・本登録済みユーザーのみが使用でき、タイトル、内容、ステータス、コメント許可フラグのパラメータを持ちます。

## 機能
- 投稿テーブルのマイグレーションファイル作成
- ユーザーとのリレーションシップを持つPostモデル実装
- 投稿作成用のPostController実装
- バリデーション用のPostRulesクラス作成
- ビジネスロジック用のPostServiceクラス実装
- 公開時のタイトル必須チェック用のPostTitleRule実装
- API用ルート更新
- 投稿API用の包括的なテストスイート追加

## アーキテクチャ
- **コントローラー**: HTTPリクエスト処理、バリデーション用Rulesの使用、ビジネスロジック用Serviceの使用
- **ルール**: バリデーションロジックと認可チェック
- **サービス**: 投稿作成のビジネスロジック
- **モデル**: データベース構造とリレーションシップ定義
- **テスト**: API機能とバリデーションルールの検証

## 実装要件
- ログイン済み・本登録済みユーザーのみ投稿可能
- 投稿はタイトル、内容、ステータス、コメント許可フラグのパラメータを持つ
- どのユーザーが投稿したかを追跡
- 権限のないユーザーには403エラーを返却
- Laravelの標準Rulesを使用したバリデーション:
  - タイトルは50文字以内
  - 内容は2000文字以内
  - 公開時のタイトル必須チェック
  - 内容は必須ではない
  - デフォルトステータスは下書き
  - 基本的なセキュリティ対策実装

## ステータスの種類
投稿には以下の3つのステータスがあります：

1. **draft（下書き）**
   - デフォルトのステータス
   - 投稿者のみが閲覧可能
   - タイトルは必須ではない
   - 内容は必須ではない
   - 編集可能

2. **published（公開）**
   - 全ユーザーに公開される
   - タイトルは必須
   - 内容は必須ではない
   - 編集可能

3. **trash（ゴミ箱）**
   - 削除予定の投稿
   - 投稿者のみが閲覧可能
   - システムによって定期的に完全削除される可能性あり
   - 復元可能

## テスト方法
以下のcurlコマンドでAPIをテストできます:

```bash
# ログインしてトークンを取得
curl -X POST http://localhost/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password"}'

# 投稿を作成（TOKENをログインレスポンスのトークンに置き換え）
curl -X POST http://localhost/api/posts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TOKEN" \
  -d '{"title":"テスト投稿","content":"これはテスト投稿です","status":"draft","allow_comments":true}'
```

## 認証エラーハンドリング
- Bearer tokenなしでリクエスト：401 Unauthorizedを返却
- 無効なBearer tokenのリクエスト：401 Unauthorizedを返却
- 有効なBearer tokenだが未認証ユーザー：403 Forbiddenを返却
